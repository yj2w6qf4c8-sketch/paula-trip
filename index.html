<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>eMenu Trip</title>

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#2563eb',
            primarySoft: '#dbeafe',
            cardBg: 'rgba(255,255,255,0.9)',
          },
          borderRadius: {
            'xl2': '1.25rem',
          },
        },
      },
    };
  </script>

  <!-- Vue 3 CDN -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>

  <style>
    body {
      background: radial-gradient(circle at top, #bfdbfe, #0f172a);
      min-height: 100vh;
    }
    .safe-bottom {
      padding-bottom: env(safe-area-inset-bottom);
    }
  </style>
</head>
<body class="text-slate-900">
  <div id="app" class="max-w-md mx-auto min-h-screen flex flex-col">
    <!-- Header -->
    <header class="pt-6 pb-4 px-4">
      <div class="flex items-center justify-between">
        <div>
          <h1 class="text-2xl font-bold text-white drop-shadow">eMenu Trip</h1>
          <p class="text-sm text-blue-100">簡易行程 · 記帳 · 購物清單</p>
        </div>
        <div class="text-xs text-blue-100 bg-blue-900/40 px-2 py-1 rounded-full">
          Demo 版
        </div>
      </div>
    </header>

    <!-- Main content card -->
    <main class="flex-1 px-4 pb-28">
      <div class="bg-cardBg backdrop-blur-md rounded-3xl shadow-lg p-4 space-y-4">

        <!-- Tabs: 行程 / 記帳 / 購物 -->
        <div class="flex bg-slate-100 rounded-full p-1 text-sm font-medium">
          <button
            class="flex-1 py-2 rounded-full transition"
            :class="currentTab === 'itinerary' ? 'bg-primary text-white shadow' : 'text-slate-500'"
            @click="currentTab = 'itinerary'"
          >
            行程
          </button>
          <button
            class="flex-1 py-2 rounded-full transition"
            :class="currentTab === 'expense' ? 'bg-primary text-white shadow' : 'text-slate-500'"
            @click="currentTab = 'expense'"
          >
            記帳
          </button>
          <button
            class="flex-1 py-2 rounded-full transition"
            :class="currentTab === 'shopping' ? 'bg-primary text-white shadow' : 'text-slate-500'"
            @click="currentTab = 'shopping'"
          >
            購物
          </button>
        </div>

        <!-- 行程分頁 -->
        <section v-if="currentTab === 'itinerary'" class="space-y-4">
          <!-- Day tabs -->
          <div class="flex overflow-x-auto space-x-2 pb-1">
            <button
              v-for="day in days"
              :key="day"
              class="px-3 py-1.5 rounded-full text-xs whitespace-nowrap border transition"
              :class="day === currentDay
                ? 'bg-primary text-white border-primary shadow'
                : 'bg-white/60 text-slate-600 border-slate-200'"
              @click="currentDay = day"
            >
              Day {{ day }}
            </button>
          </div>

          <!-- List -->
          <div v-if="filteredItinerary.length" class="space-y-2">
            <div
              v-for="(item, idx) in filteredItinerary"
              :key="idx"
              class="bg-white rounded-2xl p-3 shadow-sm flex items-start justify-between"
            >
              <div>
                <div class="text-xs text-slate-400 mb-0.5">
                  Day {{ item.day }} ・ {{ item.time || '—' }}
                </div>
                <div class="font-semibold text-slate-800">
                  {{ item.title || '未命名行程' }}
                </div>
                <div v-if="item.location" class="text-xs text-slate-500 mt-0.5">
                  {{ item.location }}
                </div>
              </div>
              <button
                class="text-slate-300 hover:text-red-400 text-xs"
                @click="removeItinerary(idx)"
                title="刪除"
              >
                ✕
              </button>
            </div>
          </div>
          <p v-else class="text-xs text-slate-400 text-center py-4">
            目前 Day {{ currentDay }} 未有行程，試下新增一個 ✨
          </p>

          <!-- Add button -->
          <div class="flex justify-end">
            <button
              class="px-4 py-2 rounded-full bg-primary text-white text-sm font-semibold shadow-md flex items-center space-x-1"
              @click="showItineraryForm = true"
            >
              <span>＋ 新增行程</span>
            </button>
          </div>
        </section>

        <!-- 記帳分頁 -->
        <section v-if="currentTab === 'expense'" class="space-y-4">
          <!-- Summary card -->
          <div class="bg-gradient-to-br from-primary to-blue-500 rounded-3xl p-4 text-white shadow">
            <div class="flex justify-between items-end mb-3">
              <div>
                <p class="text-xs text-blue-100">總支出（HKD）</p>
                <p class="text-2xl font-bold">$
                  {{ totalExpense.toLocaleString() }}
                </p>
              </div>
              <div class="text-right text-[10px] text-blue-100">
                紀錄只儲存在你裝置內
              </div>
            </div>
            <div class="grid grid-cols-2 gap-2 text-xs">
              <div class="bg-white/10 rounded-2xl px-3 py-2">
                <p class="text-blue-100">現金</p>
                <p class="text-lg font-semibold">
                  ${{ cashTotal.toLocaleString() }}
                </p>
              </div>
              <div class="bg-white/10 rounded-2xl px-3 py-2">
                <p class="text-blue-100">信用卡</p>
                <p class="text-lg font-semibold">
                  ${{ cardTotal.toLocaleString() }}
                </p>
              </div>
            </div>
          </div>

          <!-- Filter tabs -->
          <div class="flex bg-slate-100 rounded-full p-1 text-xs font-medium">
            <button
              class="flex-1 py-1.5 rounded-full"
              :class="expenseFilter === 'all' ? 'bg-white shadow text-slate-800' : 'text-slate-500'"
              @click="expenseFilter = 'all'"
            >
              全部
            </button>
            <button
              class="flex-1 py-1.5 rounded-full"
              :class="expenseFilter === 'cash' ? 'bg-white shadow text-slate-800' : 'text-slate-500'"
              @click="expenseFilter = 'cash'"
            >
              現金
            </button>
            <button
              class="flex-1 py-1.5 rounded-full"
              :class="expenseFilter === 'card' ? 'bg-white shadow text-slate-800' : 'text-slate-500'"
              @click="expenseFilter = 'card'"
            >
              信用卡
            </button>
          </div>

          <!-- List -->
          <div v-if="filteredExpense.length" class="space-y-2 max-h-64 overflow-y-auto pr-1">
            <div
              v-for="(item, idx) in filteredExpense"
              :key="idx"
              class="bg-white rounded-2xl p-3 shadow-sm flex justify-between items-center"
            >
              <div>
                <div class="text-xs text-slate-400">
                  {{ item.date || '未填日期' }} ・
                  <span :class="item.method === 'cash' ? 'text-emerald-500' : 'text-purple-500'">
                    {{ item.method === 'cash' ? '現金' : '信用卡' }}
                  </span>
                </div>
                <div class="font-semibold text-slate-800">
                  {{ item.title || '未命名支出' }}
                </div>
              </div>
              <div class="flex items-center space-x-2">
                <div class="font-semibold text-slate-900">
                  ${{ Number(item.amount || 0).toLocaleString() }}
                </div>
                <button
                  class="text-slate-300 hover:text-red-400 text-xs"
                  @click="removeExpense(idx)"
                >
                  ✕
                </button>
              </div>
            </div>
          </div>
          <p v-else class="text-xs text-slate-400 text-center py-4">
            未有支出紀錄，可以按右下角「＋記一筆」新增。
          </p>

          <!-- Add button -->
          <div class="flex justify-end">
            <button
              class="px-4 py-2 rounded-full bg-primary text-white text-sm font-semibold shadow-md flex items-center space-x-1"
              @click="showExpenseForm = true"
            >
              <span>＋ 記一筆</span>
            </button>
          </div>
        </section>

        <!-- 購物清單分頁 -->
        <section v-if="currentTab === 'shopping'" class="space-y-3">
          <div class="flex justify-between items-center">
            <h2 class="text-sm font-semibold text-slate-700">購物清單</h2>
            <button
              class="px-3 py-1.5 rounded-full bg-primary text-white text-xs font-semibold shadow"
              @click="showShoppingForm = true"
            >
              ＋ 新增
            </button>
          </div>

          <div v-if="shoppingList.length" class="space-y-2 max-h-72 overflow-y-auto pr-1">
            <div
              v-for="(item, idx) in shoppingList"
              :key="idx"
              class="bg-white rounded-2xl p-3 shadow-sm flex items-center justify-between"
            >
              <div class="flex items-center space-x-3">
                <button
                  class="w-6 h-6 rounded-full border flex items-center justify-center"
                  :class="item.bought ? 'bg-emerald-500 border-emerald-500' : 'bg-white border-slate-300'"
                  @click="toggleBought(idx)"
                >
                  <span v-if="item.bought" class="text-white text-sm">✓</span>
                </button>
                <div>
